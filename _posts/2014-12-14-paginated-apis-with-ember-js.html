---
layout:     post
title:      "Ember.js: dealing with paginated APIs"
date:       2014-12-14 13:00:00
author:     "Kevin Soltysiak"
header-img: "img/post-bg-03.jpg"
tags:       ember.js
---


<p>
  Almost every web site or application deals with pagination at some point. In this article, I will showcase two ways of dealing with paginated APIs with ember.js and ember data. Both examples consumes the same kind of API, but how the data is handled and presented differs.
</p>

<h3 id="theapi">The API</h3>

<p>
  In our examples, we are going to work with a "posts" API. Here is what our example API is returning us :
</p>

<script src="https://gist.github.com/ksol/78de1be72be401a9dcff.js"></script>

<p>
  The serialized models are available under <code>posts</code>, as ember-data expects them, and pagination-related metadata under <code>meta</code>. Ember Data looks for this specific key and makes its content accessible via the <code>store</code> or the model instances, as we will see below.
</p>

<h3 id="classicpagination">"Classic" pagination</h3>

<p>
  The first example is probably the most common. Our API returns paginated results, so we present those result to our users paginated in the same way, with links at the bottom allowing them to go to the previous, next, or any page. The URL will also reflect the current page we're presenting.
</p>

<p>
  Ember.js integrates very well with query parameters (segments of URLs that look like <code>?param=value&amp;param2=value2</code>), at both the route and controller levels. The controller will be the primary interface with the query params, which will be mapped to a property. And if a query param change should trigger an API call, we need to render our routes aware of them, too.
</p>

<p>
  In our case, our query parameter will look like <code>?page=3</code>. Since our API is paginated, both our controllers and routes need to know this parameter, and in both cases, it's a matter of a few lines of code :
</p>

<script src="https://gist.github.com/ksol/7a1d5c2cf3743bd7e5f1.js"></script>

<p>
  As you can see, most of the code is related to the display of the pagination links. The <code>queryParams</code> property on the controllers and routes is where you can list the params you're handling, and whether they should re-trigger the <code>model</code> hook on the route. And in the template, we are supplying the params to <code>link-to</code> via <code>(query-params page=num)</code> and that's about it.
</p>

<p>
  In a real world application, you would extract everything needed for the pagination links in a distinct component and reuse it accross your application.
</p>

<h3 id="appendingtothebottomloadmore">Appending to the bottom ("load more")</h3>

<p>
  There's another take on the matter that can be seen on twitter, flickr, and many blogs: there is no "page", but the content loads itself progressively as you scroll towards the bottom of the page, giving the user a feeling of "infinite" scrolling.
</p>

<p>
  Our second example is going to be similar, but simpler: at the bottom of the page, we will display a "load more" link instead of automatically doing so, since detecting the user position in the current page is a topic on its own.
</p>

<p>
  This time, we are not going to use the query parameters. We could, but having <code>?page=4</code> in the URL while displaying a full list without actual pages or pagination links might be confusing for the users.
</p>

<p>
  The route is now very straightforward, and so is the template. The controller is now in charge of fetching the additional posts and merging them with what is already loaded :
</p>

<script src="https://gist.github.com/ksol/362a899e98028768119f.js"></script>

<p>
  And that's about it. Depending on your project, you may want to include other attributes in your API query, such as the ordering attribute and direction, but the main idea is that ember makes the query parameters first-class citizens, and with ember-data it is quite easy to handle pagination metadata.
</p>

<p>
  As always, feel free to post any question or suggestions either in the comments below or on <a href="https://twitter.com/ksol">twitter</a>.
</p>

<p>
  <em>Note: Once again, those examples were extracted from existing ember-cli projects. Some things were renamed, and some typos may have been introduced.</em>
</p>
